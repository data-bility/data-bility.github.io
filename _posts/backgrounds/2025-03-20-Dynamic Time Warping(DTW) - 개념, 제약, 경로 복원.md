---
title: Dynamic Time Warping(DTW) - 개념, 제약, 경로 복원
date: 2025-03-20 00:00:00 +09:00
categories: [backgrounds]
math: true
---

## 1. 기본 개념
> 두 시계열 데이터의 **비선형적 시간왜곡**(non-linear time distortion)을 허용하면서 **유사도를 측정하는 알고리즘**입니다.  
즉, 단순히 시점이 일치하지 않더라도 형태(패턴)가 비슷한 시계열끼리의 거리를 계산할 수 있습니다.

유클리드 거리는 두 시계열의 길이가 같고, 시점이 정확히 일치할 때만 비교가 가능합니다. 하지만 현실의 시계열 데이터는 다음과 같은 특징을 갖는 경우가 있습니다.
- 동일한 패턴이라도 시간 축이 늘어나거나 압축되는 경우
- 일부 구간에서만 속도가 다른 경우

예를 들어, 다음 두 시계열이 있다고 할 때:
- A: [1, 2, 3, 4, 5]
- B: [1, 1, 2, 3, 5, 6]

이 두 시계열은 전체적인 패턴 자체는 비슷하지만, B는 일부 구간에서 더 느리거나 빠르게 진행됩니다.  
이 경우 단순한 유클리드 거리로는 유사도를 올바르게 계산하기 어렵습니다.  
DTW는 이러한 시간 축 왜곡을 보정하여 **두 시계열이 가장 잘 정렬되는 최소 거리**, 즉 **warping path**를 계산합니다.

---

## 2. 작동 원리

DTW는 두 시계열 \( X \)와 \( Y \)의 **warping path** \( W \)를 찾습니다.

$$
X = (x_1, x_2, \dots, x_n), \quad Y = (y_1, y_2, \dots, y_m)
$$

워핑 경로 \( W \)는 다음과 같이 정의됩니다.

$$
W = \{ (i_1, j_1), (i_2, j_2), \dots, (i_K, j_K) \}
$$

단, 다음 제약 조건을 만족해야 합니다.

| 제약 | 설명 |
|------|------|
| **시작/끝 조건 (Boundary)** | 경로는 (1,1)에서 시작해 (n,m)에서 끝나야 함 |
| **단조성 (Monotonicity)** | 인덱스는 감소하지 않아야 함 (시간의 역행 불가) |
| **연속성 (Continuity)** | 한 스텝에서 다음 스텝으로의 이동은 (1,0), (0,1), (1,1) 중 하나 |

즉, 한 시점에서 다음 시점으로 갈 때 한쪽만 움직이거나(시간이 느리게 흐르는 경우), 동시에 움직이는(속도가 동일한 경우) 식으로 **비선형 정렬**이 가능하게 됩니다.

---

## 3. 누적 거리 행렬 (Accumulated Distance Matrix)

DTW는 각 시점 간의 국소 거리(local distance)로부터 **누적 최소 거리**를 동적 계획법(Dynamic Programming)으로 계산합니다.

먼저, 각 시점 간의 국소 거리 행렬 \( C \)를 정의합니다.

$$
C_{i,j} = |x_i - y_j|
$$

그 다음, 누적 거리 행렬 \( D \)는 다음 점화식으로 계산됩니다.

$$
D_{i,j} = C_{i,j} + \min(D_{i-1,j},\; D_{i,j-1},\; D_{i-1,j-1})
$$

여기서
- $D_{i-1,j}$ : 위쪽 셀(시계열 X의 진행)
- $D_{i,j-1}$ : 왼쪽 셀(시계열 Y의 진행)
- $D_{i-1,j-1}$ : 대각선 셀(두 시계열이 동시에 진행)

이며, 가장 작은 누적 거리를 선택해 경로를 구성합니다.  
초기 조건은 다음과 같습니다.

$$
D_{1,1} = C_{1,1}, \quad D_{i,0} = D_{0,j} = +\infty
$$

최종적으로 $D_{n,m}$이 두 시계열 간의 최소 누적 거리(DTW distance)가 됩니다.

---

## 4. Warping Path 복원

최소 누적 거리 $D_{n,m}$이 계산되면, 역방향으로 추적(backtracking)하여 실제 워핑 경로를 복원할 수 있습니다.

1. $(n,m)$ 에서 시작
2. $\min(D_{i-1,j}, D_{i,j-1}, D_{i-1,j-1})$ 방향으로 이동
3. $(1,1)$ 에 도달할 때까지 반복

이 과정을 통해 두 시계열이 **어떤 시점끼리 매칭되었는지**를 알 수 있습니다.
