---
title: Croston Method - 간헐적 수요 예측을 위한 고전적 접근방법
date: 2024-07-30 00:00:00 +09:00
categories: [backgrounds]
math: true
---

## 1. 탐색 배경

> 본 포스팅은 기초 예측 모형 세팅 과정에서 알게된 고전적 간헐적 수요 예측 방법인 **Croston(1972)** 에 대한 내용을 정리한 것입니다.

**데이터가 충분하지 않은 신규 점포나 신상품**에 대해 30일 이동평균(MA) 또는 30일 요일평균(Day-of-week Mean)으로 baseline을 세팅해왔습니다. <br>

하지만 이 방식은 다음의 한계를 갖습니다. : 

- 판매가 자주 발생하지 않는 SKU의 경우, "0" 수요가 많은(zero-inflated) 구간에서 평균이 과도하게 낮아짐
- 실제 판매 시점의 수요량(peak)이 반영되지 않아, 초기 수요 감지 실패
- 주간 단위 기준으로 예측 시 불규칙 패턴을 평균이 상쇄

이 문제를 해결하기 위한 대안으로, 간헐적 수요(intermittent demand)를 전제로 한 **Croston Method** 를 성능 면에서 검토하였습니다. <br>
비록 1972년에 제안된 오래된 방법이지만, **"초기 예측 모델 세팅용 baseline"** 으로는 여전히 유의미한 접근이라 판단하였습니다.

---

## 2. Croston(1972)의 핵심 아이디어
> 요약 : 이 방법의 핵심은 이 두 과정을 **각각 독립적으로 지수평활법(Exponential Smoothing)** 으로 추정한 뒤, 이를 결합하여 ‘기대 수요량’을 계산한다는 점입니다.


Croston은 간헐적 수요를 두 개의 독립된 확률적 과정으로 분리하여 다루었습니다.

- $ z_t $: **수요가 발생할 때의 수요 크기 (size of demand)**
- $ p_t $: **수요 발생 간격 (interval between demands)**

즉, 전체 시계열 $ y_t $는 대부분의 시점에서는 0이지만,  
수요가 발생하는 시점 $ t_i $에서만 $ y_{t_i} = z_{t_i} $ 입니다.

---

## 3. 수식 구조

수요가 발생한 시점 $ t_i $에서만 다음의 업데이트를 수행합니다.

$$
\begin{aligned}
\hat{z}_{t_i} &= \hat{z}_{t_{i-1}} + \alpha (z_{t_i} - \hat{z}_{t_{i-1}}) \\
\hat{p}_{t_i} &= \hat{p}_{t_{i-1}} + \alpha (p_{t_i} - \hat{p}_{t_{i-1}})
\end{aligned}
$$


- $ \hat{z}_{t_i} $: 수요 크기의 지수평활 추정치
- $ \hat{p}_{t_i} $: 수요 간격의 지수평활 추정치
- $ \alpha $: smoothing parameter (보통 0.1~0.3)

다음 시점의 예측값은 다음과 같이 계산됩니다.

$$
\hat{y}_{t+1} = \frac{\hat{z}_{t_i}}{\hat{p}_{t_i}}
$$



즉,
> "예상 수요 크기 / 평균 수요 간격 = 기간당 기대 수요"

이 식은 곧,
> "수요 발생 확률 * 평균 수요량"의 형태로 해석할 수 있습니다.

---

## 4. Croston method의 장점과 한계



| 구분 | 설명                                                          |
|------|-------------------------------------------------------------|
| 장점 | 0 수요 구간의 왜곡을 줄이고, 수요 발생 시점과 크기를 분리 추정함으로써 간헐적 패턴을 반영 가능     |
| 한계 | 장기간 수요가 발생하지 않을 때 예측값이 일정하게 유지되어 과대예측 발생 가능                 |
| 개선모델 | SBA(Syntetos–Boylan Approx.), TSB(Teunter–Syntetos–Babai) 등 |



위와 같은 한계를 극복하고자 개발된 개선 모델 중 하나인 Teunter–Syntetos–Babai(TSB, 2011) 모델은 수요 발생 확률을 확률적 smoothing으로 업데이트하여 0이 지속되는 구간에서도 모델이 점진적으로 하향 조정됩니다.

---

## 5. Demand Categorization과의 연계

앞서 SKU별 수요 패턴을 **ADI–CV^2(Average Demand Interval, Coefficient of Variation Squared)** 기준으로 분류하는 **Demand Categorization**을 EDA 과정에서 수행하였습니다.



| 분류 | ADI | CV^2   | 특징 | 권장 모델 |
|------|-----|--------|------|-----------|
| Smooth | < 1.32 | < 0.49 | 규칙적 수요 | SES, ARIMA |
| Erratic | < 1.32 | ≥ 0.49 | 크기 변동이 큰 수요 | Holt-Winters |
| Intermittent | ≥ 1.32 | < 0.49 | 발생은 드물지만 크기 일정 | Croston |
| Lumpy | ≥ 1.32 | ≥ 0.49 | 불규칙 + 간헐 | TSB, ML-based |



이론적으로는 Croston method가 ADI가 크고 $CV^2$가 낮은, 즉 **“드물지만 일정한 크기의 수요군”** 에 가장 적합하다고 알려져있습니다. <br>
신규 점포/신상품 초기 데이터셋은 이와 유사한 형태를 띠긴 하지만, 1.32나 0.49 등의 cut-off는 분석 데이터에 따라 조정되어야 할 것으로 보였습니다. <br>

---

## 6. 실무 적용 아이디어

프로젝트의 초기 예측 모형 세팅 단계에서 Croston은 다음과 같이 활용 가능하리라 기대했습니다.:

- **(1) 초기 baseline 예측**
  - 기존 30일 이동평균 대비 0 수요 구간 보정 가능
  - "발생 확률 * 발생 시 수요량" 기반의 기대 수요량 계산
- **(2) 피처 엔지니어링용 변수 생성**
  - Croston 예측값 자체를 ML 모델의 입력 피처로 사용
  - 발생확률(`1 / p_hat`), 최근 간격(`p_t`) 등을 추가하여 demand sparsity 반영
- **(3) 모델 블렌딩(Blending) 구조 내 베이스라인**
  - Croston 결과를 baseline으로 두고, XGBoost나 LGBM이 이를 보정하는 구조로 확장 가능
